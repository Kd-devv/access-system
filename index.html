<!DOCTYPE html>
<html lang="sq">
<head>
  <!-- Head content i pandryshuar (ruajeni të njëjtin si në versionin tuaj origjinal) -->
  <style>
    /* Ruajini të gjitha stilizimet ekzistuese dhe shtoni këto: */
    .log-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .log-controls button {
      padding: 8px 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .log-controls button.delete {
      background: #f44336;
    }
    #filterInput {
      padding: 8px;
      width: 300px;
    }
  </style>
</head>
<body>
  <!-- Pjesa e mbetur e HTML ruhet e pandryshuar -->

  <!-- Tabi i Logjeve (përditësuar) -->
  <div id="logs-tab" class="tab-content">
    <div class="log-controls">
      <input type="text" id="filterInput" placeholder="Filtro sipas emrit, IP, statusit...">
      <button onclick="loadLogs()">🔁 Rifresko</button>
      <button onclick="exportAllXLSX()">📤 Eksporto të gjitha</button>
      <button onclick="exportFilteredXLSX()">📤 Eksporto të filtruarat</button>
      <button onclick="deleteFilteredLogs()" class="delete">🗑️ Fshij të filtruarat</button>
      <button onclick="deleteAllLogs()" class="delete">🗑️ Fshij të gjitha</button>
    </div>

    <table id="logTable">
      <thead>
        <tr>
          <th>Koha</th>
          <th>Emri</th>
          <th>PIN</th>
          <th>IP</th>
          <th>Statusi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // Ruajini të gjithë kodin ekzistues përveç pjesës së logjeve
    // Zëvendësoni vetëm pjesën e logjeve me këtë:

    let allLogs = [];

    async function loadLogs() {
      try {
        const res = await makeAuthRequest(`${apiUrl}/logs`);
        if (res.status === 401) {
          sessionStorage.removeItem("authToken");
          window.location.reload();
          return;
        }
        
        const data = await res.json();
        allLogs = Object.entries(data)
          .sort((a, b) => b[0].localeCompare(a[0]))
          .map(entry => entry[1]);
        
        renderLogs();
      } catch (err) {
        showMsg("Gabim gjatë ngarkimit të logeve: " + err.message, "error");
      }
    }

    function renderLogs() {
      const filter = document.getElementById("filterInput").value.toLowerCase();
      const tbody = document.querySelector("#logTable tbody");
      tbody.innerHTML = "";

      for (const log of allLogs) {
        const values = [log.user, log.pin, log.ip, log.status].map(v => (v || "").toLowerCase());
        if (filter && !values.some(v => v.includes(filter))) continue;

        const tr = document.createElement("tr");
        if (log.status === "success") tr.classList.add("log-success");
        else if (log.status !== "user_not_found") tr.classList.add("log-error");

        tr.innerHTML = `
          <td>${new Date(log.time).toLocaleString()}</td>
          <td>${log.user || "—"}</td>
          <td>${log.pin || "—"}</td>
          <td>${log.ip || "—"}</td>
          <td>${log.status}</td>
        `;
        tbody.appendChild(tr);
      }
    }

    // Funksionet e eksportit dhe fshirjes ruhen të njëjta si në versionin tuaj origjinal
    async function exportAllXLSX() {
      /* ... ruajeni implementimin tuaj origjinal ... */
    }

    async function exportFilteredXLSX() {
      /* ... ruajeni implementimin tuaj origjinal ... */
    }

    async function deleteFilteredLogs() {
      /* ... ruajeni implementimin tuaj origjinal ... */
    }

    async function deleteAllLogs() {
      /* ... ruajeni implementimin tuaj origjinal ... */
    }

    // Initialize
    document.getElementById("filterInput").addEventListener("input", renderLogs);
  </script>
</body>
</html>
