<!DOCTYPE html>
<html lang="sq">
<head>
  <!-- Kopjoni të gjithë HEAD tuaj origjinal këtu -->
  <meta charset="UTF-8" />
  <title>Sistemi i Kontrollit të Aksesit</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    /* Kopjoni të gjithë CSS tuaj origjinal këtu */
  </style>
</head>
<body>
  <!-- Kopjoni të gjithë HTML tuaj origjinal këtu -->
  <!-- Password Protection Screen -->
  <div id="password-protection">
    <div id="password-form">
      <h2>Hyrje në Sistem</h2>
      <input type="password" id="access-password" placeholder="Fjalëkalimi" />
      <button onclick="checkPassword()">Hyr</button>
      <div id="password-error"></div>
    </div>
  </div>

  <!-- Protected Content -->
  <div class="protected-content">
    <!-- ... Kopjoni të gjithë përmbajtjen tuaj ... -->
  </div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // ==================== RREGULLIMET E REJA ====================
    const apiUrl = "https://porta.armnis76.workers.dev";
    let allLogs = [];
    let authToken = null;

    // Rregulluar window.onload
    window.onload = async function() {
      const passwordInput = document.getElementById("access-password");
      if (!passwordInput) {
        console.error("Gabim: Elementi i fjalëkalimit nuk ekziston");
        return;
      }

      const savedToken = sessionStorage.getItem("authToken");
      if (savedToken) {
        try {
          const testResponse = await fetch(apiUrl, {
            headers: { "Authorization": `Bearer ${savedToken}` }
          });
          
          if (testResponse.ok) {
            authToken = savedToken;
            document.getElementById("password-protection").style.display = "none";
            document.querySelector(".protected-content").style.display = "block";
            fetchUsers();
            return;
          }
        } catch (err) {
          console.error("Gabim në verifikimin e token-it:", err);
        }
      }
      passwordInput.focus();
    };
    // ==================== FUND I RREGULLIMEVE ====================

    // ==================== KODI JUAJ ORIGJINAL ====================
    // Kopjoni të gjithë JavaScript-in tuaj tjetër të pandryshuar këtu
    // përfshirë checkPassword, fetchUsers, addUser, etj.
  </script>
</body>
</html>
