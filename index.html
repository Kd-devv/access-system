<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    button { padding: 8px 16px; margin: 5px; cursor: pointer; }
    .container { margin-bottom: 30px; }
  </style>
</head>
<body>
  <h1>Porta - Admin Panel</h1>
  
  <div class="container">
    <h2>Gjenero Kod Aksesi</h2>
    <div>
      <input id="username" placeholder="Emri i përdoruesit">
      <input id="adminPass" type="password" placeholder="Fjalëkalimi admin">
      <button onclick="generateCode()">Gjenero Kod</button>
    </div>
    <div id="codeResult" style="margin-top: 10px;"></div>
  </div>

  <div class="container">
    <h2>Kodet Aktive</h2>
    <table id="codesTable">
      <thead>
        <tr>
          <th>Përdoruesi</th>
          <th>Status</th>
          <th>Veprime</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const API_URL = "https://porta.armnis76.workers.dev";
    let authToken = null;

    async function login() {
      const password = prompt("Fjalëkalimi admin:");
      const res = await fetch(`${API_URL}/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password })
      });
      
      const data = await res.json();
      if (res.ok) authToken = data.token;
      else alert(data.error);
    }

    async function generateCode() {
      if (!authToken) await login();
      if (!authToken) return;

      const username = document.getElementById("username").value.trim();
      const adminPass = document.getElementById("adminPass").value;

      try {
        const res = await fetch(`${API_URL}/generate-code`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${authToken}`
          },
          body: JSON.stringify({ username, adminPass })
        });

        const data = await res.json();
        if (res.ok) {
          document.getElementById("codeResult").innerHTML = `
            <strong>Kodi:</strong> ${data.code}<br>
            <strong>URL:</strong> ${data.url}
          `;
          loadActiveCodes();
        } else {
          alert(data.error || "Gabim i panjohur");
        }
      } catch (err) {
        alert("Gabim në rrjet: " + err.message);
      }
    }

    async function loadActiveCodes() {
      // Implementimi aktual varet nga struktura e të dhënave
      // Kjo është vetëm një shembull
      const tbody = document.querySelector("#codesTable tbody");
      tbody.innerHTML = "<tr><td colspan='3'>Po ngarkohen...</td></tr>";

      try {
        // Në praktikë, do të duhej një endpoint për të marrë të dhënat
        tbody.innerHTML = `
          <tr>
            <td>user1</td>
            <td>Aktiv</td>
            <td>
              <button>Zgjat</button>
              <button style="color:red">Çaktivizo</button>
            </td>
          </tr>
        `;
      } catch (err) {
        tbody.innerHTML = `<tr><td colspan='3'>${err.message}</td></tr>`;
      }
    }

    // Initialize
    window.onload = login;
  </script>
</body>
</html>
